{"version":3,"file":"marketdata-factory.js","sourceRoot":"","sources":["../../MDCapture/marketdata-factory.ts"],"names":[],"mappings":"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","sourcesContent":["import {\r\n    SubscriptionRequestType,\r\n    MDUpdateType,\r\n    MDEntryType,\r\n    MDUpdateAction,\r\n    MDReqRejReason,\r\n    MDImplicitDelete,\r\n    IInstrument,\r\n    IMarketDataRequest,\r\n    IMarketDataSnapshotFullRefresh,\r\n    IMarketDataIncrementalRefresh,\r\n    IMarketDataRequestReject,\r\n    IInstrmtMDReqGrp,\r\n    SecurityListRequestType,\r\n    ISecurityListRequest,\r\n    ITestRequest,\r\n    IMassQuote,\r\n    IMassQuoteAcknowledgement\r\n} from 'jspurefix/dist/types/FIX4.4/repo'\r\nimport { MsgView, MsgType } from 'jspurefix';\r\nimport { lchmod } from 'fs';\r\nimport { Common } from './common';\r\nimport { ILiveQuote } from './LiveQuote';\r\n\r\nexport interface ILiveQuotes {\r\n    TimeStamp: Date;\r\n    Symbol: string;\r\n    BrokerName: string;\r\n    Bid: number;\r\n    Ask: number;\r\n    Spread: number;\r\n    SpreadAvg?: number;\r\n    fpoint?: number;\r\n}\r\n\r\n// export interface IAvegareSpread {\r\n//     TimeStamp: Date;\r\n//     Symbol: string;\r\n//     BrokerName: string;\r\n//     Duration: number;\r\n//     AvgSpread: number;\r\n// }\r\n\r\nexport class MarketDataFactory {\r\n\r\n    /**\r\n     * createMarketDataRequest\r\n     */\r\n    public static createMarketDataRequest(requestId: string, msgType: SubscriptionRequestType = SubscriptionRequestType.SnapshotAndUpdates, symbol: string, updateType: number = null): IMarketDataRequest {\r\n        let instruments: IInstrmtMDReqGrp = {\r\n            Instrument: {\r\n                Symbol: symbol\r\n            }\r\n        }\r\n        return {\r\n            SubscriptionRequestType: msgType,\r\n            MDReqID: requestId,\r\n            MarketDepth: 0,\r\n            //MDUpdateType: updateType,\r\n            InstrmtMDReqGrp: [instruments],\r\n            // MDReqGrp: [\r\n            //     {\r\n            //         MDEntryType: MDEntryType.Bid\r\n            //     },\r\n            //     {\r\n            //         MDEntryType: MDEntryType.Offer\r\n            //     }\r\n            // ]\r\n        } as IMarketDataRequest;\r\n    }\r\n\r\n    public static createSecurityListRequest(requestId: string, msgType: SecurityListRequestType = SecurityListRequestType.Symbol): ISecurityListRequest {\r\n        return {\r\n            SecurityReqID: requestId,\r\n            SecurityListRequestType: msgType\r\n        } as ISecurityListRequest\r\n    }\r\n\r\n    public static createTestRequest(requestId: string): ITestRequest {\r\n        return {\r\n            TestReqID: requestId\r\n        } as ITestRequest\r\n    }\r\n\r\n    public static createMassQuoteAcknowledgement(quoteId: string): IMassQuoteAcknowledgement {\r\n        return {\r\n            QuoteID: quoteId\r\n        } as IMassQuoteAcknowledgement \r\n    }\r\n\r\n    /**\r\n     * parseLiveQuote\r\n     */\r\n    public static parseLiveQuotes(msgType: string, msgView: MsgView): ILiveQuote[] {\r\n        try {\r\n            switch (msgType) {\r\n                case MsgType.MarketDataSnapshotFullRefresh: {\r\n                    // create an object and cast to the interface\r\n                    const md: IMarketDataSnapshotFullRefresh = msgView.toObject()\r\n                    const b = (md.MDFullGrp.find(g => g.MDEntryType === MDEntryType.Bid)) ? md.MDFullGrp.find(g => g.MDEntryType === MDEntryType.Bid).MDEntryPx : 0\r\n                    const a = (md.MDFullGrp.find(g => g.MDEntryType === MDEntryType.Offer)) ? md.MDFullGrp.find(g => g.MDEntryType === MDEntryType.Offer).MDEntryPx : 0\r\n\r\n                    let lq: ILiveQuote = {\r\n                        timeStamp: md.StandardHeader.SendingTime,\r\n                        symbol: md.Instrument.Symbol,\r\n                        bid: b,\r\n                        ask: a\r\n                    }\r\n\r\n                    return [lq]\r\n                }\r\n\r\n                case MsgType.MarketDataIncrementalRefresh: {\r\n                    const md: IMarketDataIncrementalRefresh = msgView.toObject()\r\n                    const b = (md.MDIncGrp.find(g => g.MDEntryType === MDEntryType.Bid)) ? md.MDIncGrp.find(g => g.MDEntryType === MDEntryType.Bid).MDEntryPx : 0\r\n                    const a = (md.MDIncGrp.find(g => g.MDEntryType === MDEntryType.Offer)) ? md.MDIncGrp.find(g => g.MDEntryType === MDEntryType.Offer).MDEntryPx : 0\r\n\r\n                    let lq: ILiveQuote = {\r\n                        timeStamp: md.StandardHeader.SendingTime,\r\n                        symbol: md.MDIncGrp[0].Instrument.Symbol,\r\n                        bid: b,\r\n                        ask: a\r\n                    }\r\n                    return [lq]\r\n                }\r\n                case MsgType.MassQuote: {\r\n                    const mq: IMassQuote = msgView.toObject();\r\n                    const quoteSets = mq.QuotSetGrp;\r\n                    const lqs: ILiveQuote[] = quoteSets.map(q => {\r\n                        let lq: ILiveQuote = {\r\n                            timeStamp: mq.StandardHeader.SendingTime,\r\n                            reqID: q.QuoteSetID,\r\n                            bid: q.QuotEntryGrp.find(e => e.QuoteEntryID == '0').BidPx ? q.QuotEntryGrp.find(e => e.QuoteEntryID == '0').BidPx : -1,\r\n                            ask: q.QuotEntryGrp.find(e => e.QuoteEntryID == '0').OfferPx ? q.QuotEntryGrp.find(e => e.QuoteEntryID == '0').OfferPx : -1\r\n                        }\r\n                        return lq;\r\n                    });\r\n                    return lqs;\r\n                }\r\n                default: {\r\n                    return undefined;\r\n                }\r\n            }\r\n        } catch (error) {\r\n            throw new Error('Error parsing LiveQuote - ' + error);\r\n        }\r\n\r\n    }\r\n\r\n}\r\n"]}